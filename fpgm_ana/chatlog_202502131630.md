以下是一个Python程序，用于分析用户输入的Python代码并提取所有查询和筛选条件：

```python
import ast
import sqlparse
import pandas as pd

class CodeAnalyzer(ast.NodeVisitor):
    def __init__(self):
        self.conditions = []
        self.variables = {}
    
    def visit_Assign(self, node):
        """记录变量赋值信息"""
        if isinstance(node.value, (ast.Constant, ast.Compare, ast.BinOp, ast.BoolOp)):
            for target in node.targets:
                if isinstance(target, ast.Name):
                    self.variables[target.id] = node.value
        self.generic_visit(node)
    
    def visit_Call(self, node):
        """处理函数调用"""
        if isinstance(node.func, ast.Attribute):
            method_name = node.func.attr
            args = node.args
            
            # 处理SQL查询
            if method_name in ['query', 'execute'] and args:
                self._process_sql_call(node, args[0], method_name)
            
            # 处理pandas的query方法
            if method_name == 'query' and args:
                self._process_pandas_query(node, args[0])
        
        self.generic_visit(node)
    
    def visit_Subscript(self, node):
        """处理布尔索引条件"""
        slice_node = node.slice if not isinstance(node.slice, ast.Index) else node.slice.value
        
        if isinstance(slice_node, (ast.Compare, ast.BinOp, ast.BoolOp)):
            self._record_pandas_condition(slice_node, node.lineno)
        elif isinstance(slice_node, ast.Name) and slice_node.id in self.variables:
            self._record_pandas_condition(self.variables[slice_node.id], node.lineno)
        
        self.generic_visit(node)
    
    def _process_sql_call(self, node, arg_node, method_name):
        """处理SQL查询调用"""
        sql = self._extract_string_value(arg_node)
        if sql:
            source_type = 'BigQuery' if method_name == 'query' else 'Other SQL'
            for condition in self._parse_sql_conditions(sql):
                self.conditions.append({
                    'Type': source_type,
                    'Condition': condition,
                    'Location': f"Line {node.lineno}"
                })
    
    def _process_pandas_query(self, node, arg_node):
        """处理pandas query方法"""
        query_str = self._extract_string_value(arg_node)
        if query_str:
            self.conditions.append({
                'Type': 'Pandas',
                'Condition': query_str,
                'Location': f"Line {node.lineno}"
            })
    
    def _record_pandas_condition(self, condition_node, lineno):
        """记录pandas布尔条件"""
        try:
            condition = ast.unparse(condition_node)
            self.conditions.append({
                'Type': 'Pandas',
                'Condition': condition,
                'Location': f"Line {lineno}"
            })
        except:
            pass
    
    def _extract_string_value(self, node):
        """提取字符串值，支持直接字符串或变量引用"""
        if isinstance(node, ast.Constant) and isinstance(node.value, str):
            return node.value
        if isinstance(node, ast.Name) and node.id in self.variables:
            var_node = self.variables[node.id]
            if isinstance(var_node, ast.Constant) and isinstance(var_node.value, str):
                return var_node.value
        return None
    
    @staticmethod
    def _parse_sql_conditions(sql):
        """解析SQL中的条件"""
        conditions = []
        parsed = sqlparse.parse(sql)
        for statement in parsed:
            for token in statement.tokens:
                if isinstance(token, sqlparse.sql.Where):
                    where_str = token.value.replace("WHERE", "", 1).strip()
                    conditions.extend([cond.strip() for cond in re.split(r'\b(?:AND|OR)\b', where_str)])
        return conditions

def analyze_code(code):
    """分析代码并返回结果"""
    tree = ast.parse(code)
    analyzer = CodeAnalyzer()
    analyzer.visit(tree)
    return pd.DataFrame(analyzer.conditions)

if __name__ == "__main__":
    code = input("请输入要分析的Python代码：\n")
    try:
        result_df = analyze_code(code)
        print("\n分析结果：")
        print(result_df.to_string(index=False))
    except Exception as e:
        print(f"分析时出错：{e}")
```

### 功能说明：
1. **支持的查询类型**：
   - BigQuery查询（使用`query()`方法）
   - 其他SQL数据库查询（使用`execute()`方法）
   - Pandas的条件筛选（包括布尔索引和`query()`方法）

2. **输出列说明**：
   - **Type**：条件来源（BigQuery/Pandas/Other SQL）
   - **Condition**：提取的条件表达式
   - **Location**：代码位置（行号）

3. **技术特点**：
   - 使用AST解析分析代码结构
   - 支持变量传递的简单跟踪（如先赋值字符串给变量再使用）
   - 使用sqlparse解析SQL语句中的WHERE条件
   - 自动处理布尔索引和pandas query方法

### 使用示例：
输入代码：
```python
from google.cloud import bigquery
import pandas as pd

client = bigquery.Client()
sql = "SELECT * FROM dataset.users WHERE age > 18 AND country = 'CN'"
df = client.query(sql).to_dataframe()

# Pandas条件筛选
adults = df[df['age'] >= 18]
students = df.query("score > 90")

# PostgreSQL查询
import psycopg2
conn = psycopg2.connect()
cur = conn.cursor()
cur.execute("UPDATE orders SET status = 'shipped' WHERE total > 100")
```

输出结果：
```
Type      Condition                     Location
BigQuery  age > 18 AND country = 'CN'  Line 6
Pandas    df['age'] >= 18              Line 9
Pandas    score > 90                   Line 10
Other SQL total > 100                  Line 16
```

### 注意事项：
1. 只能解析直接写在代码中的静态条件
2. 复杂表达式可能无法完全解析
3. 行号信息基于AST解析结果，可能与实际代码略有差异
4. 需要Python 3.9+环境（因使用ast.unparse）
